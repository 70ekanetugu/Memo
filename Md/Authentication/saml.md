# SAML認証メモ
## 用語
- SAML(Security Assertion Markup Language)
  異なるドメイン間でユーザー認証を行う(セキュリティ情報を交換する)為のXMLベースの規格。(2019年時点でver2.0)
  SAMLの利用により、一度認証用サーバーにログインするだけで、他の複数サービスを利用できるシングルサインオンが利用できる。
- IdP(Identity Provider)
  ログインIDやIDの持つ情報の正当性(本人性)を保証するアサーション(認証チケットみたいな?)発行側の事。(AWS,GooGle,OpenAMなど)
- SP(Service Provider)
  WEBサービスの提供側の事。(ex.Cyboze,Dropboxなど)
- アサーション(Assertion)
  SAMLオーソリティによって発行される証明の事。  
  この証明は対象とする主体(Subject:人またはコンピュータ)の認証や属性あるいは資源に関する認可権限のこと。
  PKIの公開鍵証明と異なり有効期限が無く、短期の有効期間(数時間程度)で問い合わせに対してオーソリティが応答として返す。
- オーソリティ(Authority)
  以下の３つがあり、リクエストにその正当性を証明する応答(アサーション)を返すシステムエンティティ。
  - 認証オーソリティ(Authenication Authority)
    問い合わせに対して、認証環境を検証して本人証明する認証アサーションを発行するサーバ。
    なお、認証アサーションは再利用(SSO)を可能にする。
  - 属性オーソリティ(Attribute Authority)
    認証権限の許可をアサーションとして返す。
    要は、権限、資格、役職のような情報群。
  - ポリシー決定点(PDP:Policy Decision Point)
    アクセス制御の権限が何であるかの証明をアサーションとして返すところ。
- ポリシー実行点(PEP:Policy Enforcement Point)
  PDPの証明に従ってアクセス制御を実行しその結果を返す。
  要はアプリケーションサーバの事。

## SAMLフロー
1. ブラウザからSP(Webサーバ)にアクセスする。
2. SPはSAML認証要求のXMLを生成し、Idpにユーザーをリダイレクトさせる。
3. IdpがSAML認証(XML)を解析し、ユーザーに認証情報を入力させる。
4. 認証情報が問題なければ、IdpはSAML認証応答(XML)を作成し、ユーザーにリダイレクトさせる。
5. SPはSAML応答を検証し、ユーザーのログインを許可する。
